<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bi·ªÉu Th·ª©c ƒê·∫°i S·ªë - Ch√¢n Tr·ªùi S√°ng T·∫°o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 24px 24px;
        }
        h1, h2, h3, .hand-font {
            font-family: 'Patrick Hand', cursive;
        }
        .section-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px 20px 0 20px;
            display: inline-block;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.5rem;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
            position: absolute;
            top: -20px;
            right: 0;
        }
        .notebook-paper {
            background-color: #fef3c7;
            background-image: linear-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 100% 1.5rem;
            line-height: 1.5rem;
            position: relative;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
        }
        .notebook-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 40px;
            height: 100%;
            width: 2px;
            background-color: #f87171;
        }
        .expression-tag {
            cursor: pointer;
            transition: transform 0.2s;
            user-select: none;
        }
        .expression-tag:active { transform: scale(0.95); }
        
        .quiz-option {
            transition: all 0.3s;
            cursor: pointer;
        }
        .quiz-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .hidden-section {
            opacity: 0.5;
            pointer-events: none;
            filter: blur(2px);
            transition: all 0.5s ease;
        }
        .active-section {
            opacity: 1;
            pointer-events: auto;
            filter: blur(0);
        }
        
        /* Frame Diagram Styles */
        .frame-diagram {
            width: 200px;
            height: 160px;
            background-color: #a5b4fc; /* Frame color */
            border: 2px solid #4338ca;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .frame-inner {
            width: 140px;
            height: 100px;
            background-color: white;
            border: 1px dashed #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #6b7280;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex justify-center">

    <div class="max-w-5xl w-full space-y-16">

        <!-- HEADER -->
        <header class="text-center relative py-8">
            <h1 class="text-5xl md:text-6xl text-blue-900 mb-2 drop-shadow-md">Bi·ªÉu Th·ª©c ƒê·∫°i S·ªë üìê</h1>
            <p class="text-xl text-blue-700 font-bold bg-white/80 inline-block px-6 py-2 rounded-full border border-blue-200">
                To√°n 7 - Ch√¢n Tr·ªùi S√°ng T·∫°o (Trang 25-28)
            </p>
        </header>

        <!-- PH·∫¶N 1: TH·ª∞C H√ÄNH 1 - NH·∫¨N D·∫†NG -->
        <section id="section-1" class="relative bg-white rounded-[2rem] p-8 pt-12 shadow-xl border-4 border-green-100">
            <div class="section-header bg-green-500">üß© Th·ª±c H√†nh 1 (Trang 26)</div>
            <p class="text-center text-gray-600 mb-6 italic">H√£y gi√∫p b·∫°n Ong ph√¢n lo·∫°i c√°c bi·ªÉu th·ª©c sau v√†o ƒë√∫ng t·ªï nh√©!</p>

            <div id="drag-container" class="flex flex-wrap justify-center gap-4 mb-8 min-h-[60px]">
                <div onclick="moveItem(this)" class="expression-tag bg-white border-2 border-gray-300 text-gray-700 text-lg font-mono px-4 py-2 rounded-full shadow-sm hover:shadow-md" data-type="dai-so">a¬≤ + b</div>
                <div onclick="moveItem(this)" class="expression-tag bg-white border-2 border-gray-300 text-gray-700 text-lg font-mono px-4 py-2 rounded-full shadow-sm hover:shadow-md" data-type="so">23 + 8 . 2</div>
                <div onclick="moveItem(this)" class="expression-tag bg-white border-2 border-gray-300 text-gray-700 text-lg font-mono px-4 py-2 rounded-full shadow-sm hover:shadow-md" data-type="dai-so">4x</div>
                <div onclick="moveItem(this)" class="expression-tag bg-white border-2 border-gray-300 text-gray-700 text-lg font-mono px-4 py-2 rounded-full shadow-sm hover:shadow-md" data-type="so">15 : 3</div>
                <div onclick="moveItem(this)" class="expression-tag bg-white border-2 border-gray-300 text-gray-700 text-lg font-mono px-4 py-2 rounded-full shadow-sm hover:shadow-md" data-type="dai-so">2(y+1)</div>
            </div>

            <div class="grid grid-cols-2 gap-8">
                <div id="zone-so" class="bg-orange-50 rounded-3xl p-6 border-2 border-dashed border-orange-400 min-h-[150px] relative">
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-orange-100 px-4 py-1 rounded-full font-bold text-orange-700 border border-orange-300">Bi·ªÉu Th·ª©c S·ªë</div>
                    <div class="content flex flex-wrap gap-2 pt-4 justify-center"></div>
                </div>
                <div id="zone-dai-so" class="bg-purple-50 rounded-3xl p-6 border-2 border-dashed border-purple-400 min-h-[150px] relative">
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-purple-100 px-4 py-1 rounded-full font-bold text-purple-700 border border-purple-300">Bi·ªÉu Th·ª©c ƒê·∫°i S·ªë</div>
                    <div class="content flex flex-wrap gap-2 pt-4 justify-center"></div>
                </div>
            </div>
            <div class="text-center mt-4">
                <button onclick="checkPractice1()" class="bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-2 rounded-full shadow-lg transition transform active:scale-95">Ki·ªÉm Tra & ƒêi Ti·∫øp</button>
                <p id="p1-result" class="mt-2 font-bold text-lg"></p>
            </div>
        </section>

        <!-- PH·∫¶N 2: S·ªî TAY KI·∫æN TH·ª®C 1 (KH√ÅI NI·ªÜM) -->
        <section id="section-notebook-1" class="hidden-section relative bg-white rounded-[2rem] p-8 pt-12 shadow-xl border-4 border-yellow-200">
            <div class="section-header bg-yellow-500">üìù S·ªï Tay: Kh√°i Ni·ªám</div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="notebook-paper p-6 rounded-lg text-slate-800 text-lg pl-16 rotate-1">
                    <h3 class="font-bold text-xl text-red-600 mb-2 underline decoration-wavy">1. Kh√°i ni·ªám (Trang 25):</h3>
                    <ul class="list-disc space-y-2">
                        <li><b>Bi·ªÉu th·ª©c s·ªë:</b> C√°c s·ªë ƒë∆∞·ª£c n·ªëi v·ªõi nhau b·ªüi d·∫•u ph√©p t√≠nh (+, -, ., :, ^). V√≠ d·ª•: <span class="font-mono bg-yellow-100 px-1">2+3</span></li>
                        <li><b>Bi·ªÉu th·ª©c ƒë·∫°i s·ªë:</b> Bi·ªÉu th·ª©c g·ªìm c√°c s·ªë v√† <b>c√°c ch·ªØ</b> (ƒë·∫°i di·ªán cho s·ªë) n·ªëi v·ªõi nhau b·ªüi ph√©p t√≠nh. V√≠ d·ª•: <span class="font-mono bg-yellow-100 px-1">2x+y</span></li>
                        <li>Trong bi·ªÉu th·ª©c ƒë·∫°i s·ªë, nh·ªØng ch·ªØ ƒë·∫°i di·ªán cho m·ªôt s·ªë t√πy √Ω g·ªçi l√† <b>bi·∫øn s·ªë</b>.</li>
                    </ul>
                </div>
                <div class="flex flex-col justify-center items-center gap-4">
                    <div class="bg-yellow-50 p-4 rounded-xl text-center">
                        <i class="fas fa-lightbulb text-4xl text-yellow-400 mb-2"></i>
                        <p class="text-gray-600">C√°c em h√£y ghi nh·ªõ s·ª± kh√°c bi·ªát gi·ªØa hai lo·∫°i bi·ªÉu th·ª©c nh√©!</p>
                    </div>
                    <button onclick="unlockSection('section-guide-value')" class="bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-bold px-8 py-3 rounded-full shadow-lg transition transform active:scale-95 animate-bounce">
                        Sang ph·∫ßn ti·∫øp theo üöÄ
                    </button>
                </div>
            </div>
        </section>

        <!-- PH·∫¶N 3: HO·∫†T ƒê·ªòNG H∆Ø·ªöNG D·∫™N (M·ªöI) -->
        <section id="section-guide-value" class="hidden-section relative bg-white rounded-[2rem] p-8 pt-12 shadow-xl border-4 border-pink-100">
            <div class="section-header bg-pink-500">üéÆ Ho·∫°t ƒê·ªông: Th·ª≠ T√†i Thay S·ªë</div>
            <div class="flex flex-col items-center gap-6">
                <p class="text-xl text-gray-700 text-center">
                    L√†m th·∫ø n√†o ƒë·ªÉ t√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c <b class="text-pink-600">2x + 1</b> t·∫°i <b class="text-pink-600">x = 3</b>?
                </p>
                
                <!-- H·ªôp bi·ªÉu th·ª©c t∆∞∆°ng t√°c -->
                <div class="bg-slate-800 text-white p-8 rounded-2xl font-mono text-4xl shadow-lg border-4 border-slate-600 w-full max-w-md text-center transition-all duration-500" id="demo-display">
                    2<span id="demo-var" class="text-pink-400 font-bold border-2 border-dashed border-pink-400 rounded px-1">x</span> + 1
                </div>

                <!-- ƒêi·ªÅu khi·ªÉn -->
                <div class="flex gap-4" id="demo-controls">
                    <button onclick="runDemoStep1()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold px-6 py-3 rounded-full shadow-lg transition transform active:scale-95 text-lg">
                        B∆∞·ªõc 1: Thay x = 3
                    </button>
                </div>
                
                <p id="demo-explanation" class="text-lg text-indigo-600 font-bold h-8"></p>

                <button id="btn-finish-demo" onclick="unlockSection('section-notebook-2')" class="hidden bg-green-500 hover:bg-green-400 text-white font-bold px-8 py-3 rounded-full shadow-lg transition transform active:scale-95 animate-pulse">
                    ƒê√£ hi·ªÉu! M·ªü kh√≥a ki·∫øn th·ª©c üìù
                </button>
            </div>
        </section>

        <!-- PH·∫¶N 4: S·ªî TAY KI·∫æN TH·ª®C 2 (GI√Å TR·ªä) -->
        <section id="section-notebook-2" class="hidden-section relative bg-white rounded-[2rem] p-8 pt-12 shadow-xl border-4 border-blue-200">
            <div class="section-header bg-blue-500">üìù S·ªï Tay: Gi√° Tr·ªã Bi·ªÉu Th·ª©c</div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="notebook-paper p-6 rounded-lg text-slate-800 text-lg pl-16 rotate-1">
                    <h3 class="font-bold text-xl text-red-600 mb-2 underline decoration-wavy">2. Gi√° tr·ªã bi·ªÉu th·ª©c (Trang 28):</h3>
                    <p>ƒê·ªÉ t√≠nh gi√° tr·ªã c·ªßa m·ªôt bi·ªÉu th·ª©c ƒë·∫°i s·ªë t·∫°i nh·ªØng gi√° tr·ªã cho tr∆∞·ªõc c·ªßa c√°c bi·∫øn, ta l√†m theo 2 b∆∞·ªõc:</p>
                    <ol class="list-decimal pl-5 space-y-1 mt-2 font-bold text-indigo-700">
                        <li><b>Thay</b> c√°c gi√° tr·ªã ƒë√≥ v√†o bi·ªÉu th·ª©c.</li>
                        <li><b>Th·ª±c hi·ªán</b> ph√©p t√≠nh.</li>
                    </ol>
                </div>
                <div class="flex flex-col justify-center items-center">
                    <p class="text-xl text-gray-600 mb-4 text-center">C√°c em ƒë√£ n·∫Øm ƒë∆∞·ª£c quy tr√¨nh ch∆∞a?</p>
                    <button onclick="unlockSection('section-practice')" class="bg-blue-400 hover:bg-blue-300 text-white font-bold px-8 py-3 rounded-full shadow-lg transition transform active:scale-95 animate-bounce">
                        Luy·ªán t·∫≠p ngay ‚úçÔ∏è
                    </button>
                </div>
            </div>
        </section>

        <!-- PH·∫¶N 5: TH·ª∞C H√ÄNH 2 & V·∫¨N D·ª§NG 1 -->
        <section id="section-practice" class="hidden-section relative bg-white rounded-[2rem] p-8 pt-12 shadow-xl border-4 border-indigo-100">
            <div class="section-header bg-indigo-500">‚úçÔ∏è Th·ª±c H√†nh 2 & V·∫≠n D·ª•ng 1</div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Th·ª±c h√†nh 2 -->
                <div>
                    <h3 class="text-xl font-bold text-indigo-900 mb-3 bg-indigo-50 px-4 py-2 rounded-lg">Th·ª±c H√†nh 2 (Trang 27):</h3>
                    <div class="mb-4">
                        <p class="mb-2">Vi·∫øt bi·ªÉu th·ª©c ƒë·∫°i s·ªë bi·ªÉu th·ªã di·ªán t√≠ch c·ªßa <b>h√¨nh thang</b> c√≥ ƒë√°y l·ªõn l√† <b>a</b>, ƒë√°y nh·ªè l√† <b>b</b>, chi·ªÅu cao l√† <b>h</b> ($a, b, h > 0$).</p>
                        
                        <div class="flex justify-center mb-4">
                            <svg width="150" height="80" viewBox="0 0 150 80">
                                <polygon points="30,10 120,10 140,70 10,70" style="fill:#e0e7ff;stroke:#4338ca;stroke-width:2" />
                                <text x="70" y="25" fill="#4338ca" font-size="12" font-weight="bold">b</text>
                                <text x="70" y="78" fill="#4338ca" font-size="12" font-weight="bold">a</text>
                                <line x1="120" y1="10" x2="120" y2="70" style="stroke:#6b7280;stroke-width:1;stroke-dasharray:4" />
                                <text x="125" y="45" fill="#6b7280" font-size="12">h</text>
                            </svg>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="checkOption(this, true, 'th2')" class="quiz-option th2 p-2 border rounded text-center font-mono text-lg font-bold">
                                (a + b)h<br><span class="border-t border-black w-full block my-1"></span>2
                            </button>
                            <button onclick="checkOption(this, false, 'th2')" class="quiz-option th2 p-2 border rounded text-center font-mono text-lg font-bold my-auto">(a + b)h</button>
                        </div>
                    </div>
                </div>

                <!-- V·∫≠n d·ª•ng 1 -->
                <div class="border-l-2 border-indigo-100 pl-6 md:pl-8">
                    <h3 class="text-xl font-bold text-indigo-900 mb-3 bg-indigo-50 px-4 py-2 rounded-lg">V·∫≠n D·ª•ng 1 (Trang 27):</h3>
                    <p class="text-gray-700 mb-4">
                        Khung ·∫£nh h√¨nh ch·ªØ nh·∫≠t v·ªõi hai c·∫°nh li√™n ti·∫øp b·∫±ng <b>3a</b> cm v√† <b>4a</b> cm v·ªõi b·ªÅ r·ªông b·∫±ng <b>2</b> cm.
                        <br>Vi·∫øt bi·ªÉu th·ª©c bi·ªÉu th·ªã <b>di·ªán t√≠ch c·ªßa t·∫•m ·∫£nh</b> (ph·∫ßn m√†u tr·∫Øng)?
                    </p>
                    
                    <div class="flex justify-center mb-4">
                        <div class="frame-diagram relative">
                            <span class="absolute -top-6 text-xs text-indigo-800 font-bold">3a</span>
                            <span class="absolute -left-6 top-1/2 -translate-y-1/2 text-xs text-indigo-800 font-bold">4a</span>
                            <div class="absolute right-2 top-2 text-[10px] text-white font-bold bg-indigo-800 px-1 rounded">2cm</div>
                            <div class="frame-inner"><span>·∫¢nh</span></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 gap-2">
                        <button onclick="checkOption(this, false, 'vd1')" class="quiz-option vd1 p-2 border rounded text-left px-4 font-mono">A. 3a . 4a</button>
                        <button onclick="checkOption(this, false, 'vd1')" class="quiz-option vd1 p-2 border rounded text-left px-4 font-mono">B. (3a - 2)(4a - 2)</button>
                        <button onclick="checkOption(this, true, 'vd1')" class="quiz-option vd1 p-2 border rounded text-left px-4 font-mono">C. (3a - 4)(4a - 4)</button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2 italic">*G·ª£i √Ω: Chi·ªÅu d√†i v√† r·ªông c·ªßa ·∫£nh ph·∫£i tr·ª´ ƒëi b·ªÅ r·ªông vi·ªÅn ·ªü c·∫£ 2 b√™n (2cm + 2cm).</p>
                </div>
            </div>
            
            <div class="text-center mt-6">
                <button onclick="unlockSection('section-calc')" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold px-6 py-2 rounded-full shadow-lg transition">Ti·∫øp t·ª•c ‚¨áÔ∏è</button>
            </div>
        </section>

        <!-- PH·∫¶N 6: T·ª∞ T√çNH GI√Å TR·ªä (M√ÅY T√çNH) -->
        <section id="section-calc" class="hidden-section relative bg-gradient-to-br from-slate-700 to-slate-900 rounded-[2rem] p-8 pt-12 shadow-2xl text-white overflow-hidden">
            <div class="section-header bg-slate-600">ü§ñ M√°y T√≠nh Gi√° Tr·ªã</div>
            <div class="grid md:grid-cols-2 gap-12 relative z-10">
                <!-- Ch·ªçn b√†i t·∫≠p -->
                <div class="space-y-6">
                    <div class="bg-white/10 p-5 rounded-2xl border border-white/20 hover:bg-white/20 transition cursor-pointer" onclick="setupCalculation('th3')">
                        <h4 class="text-yellow-300 font-bold text-xl mb-2">Th·ª±c H√†nh 3 (SGK Trang 27):</h4>
                        <p>T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c <span class="font-mono bg-black/30 px-2 py-1 rounded text-green-400">P = 3x¬≤ - 4x</span> t·∫°i <b>x = 2</b>.</p>
                        <p class="text-sm text-gray-400 mt-2">üëâ Nh·∫•p ƒë·ªÉ l√†m b√†i</p>
                    </div>
                    <div class="bg-white/10 p-5 rounded-2xl border border-white/20 hover:bg-white/20 transition cursor-pointer" onclick="setupCalculation('vd2')">
                        <h4 class="text-pink-300 font-bold text-xl mb-2">V·∫≠n D·ª•ng 2 (Trang 28): Gi√° gi√†y</h4>
                        <p>Gi√° b√°n = C + C.r (v·ªõi r l√† thu·∫ø VAT).<br>T√≠nh gi√° ƒë√¥i gi√†y khi gi√° g·ªëc <b>C = 600</b> (ngh√¨n ƒë·ªìng), thu·∫ø <b>r = 10%</b>.</p>
                        <p class="text-sm text-gray-400 mt-2">üëâ Nh·∫•p ƒë·ªÉ l√†m b√†i</p>
                    </div>
                    <div class="bg-white/10 p-5 rounded-2xl border-2 border-red-500/50 hover:bg-red-500/20 transition cursor-pointer" onclick="setupCalculation('negative')">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-red-400 font-bold text-xl">üî• Th·ª≠ Th√°ch: S·ªë √Çm</h4>
                            <span class="bg-red-500 text-xs px-2 py-1 rounded font-bold text-white">KH√ì</span>
                        </div>
                        <p>T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c <span class="font-mono bg-black/30 px-2 py-1 rounded text-green-400">A = 2x¬≤ - 5x</span> t·∫°i <b>x = -4</b>.</p>
                        <p class="text-sm text-gray-400 mt-2">üëâ Nh·∫•p ƒë·ªÉ th·ª≠ s·ª©c</p>
                    </div>
                </div>

                <!-- Khu v·ª±c nh·∫≠p li·ªáu -->
                <div class="bg-black/40 p-6 rounded-3xl border-4 border-slate-500 shadow-inner flex flex-col justify-center min-h-[300px]">
                    <div id="calc-interface" class="hidden">
                        <h5 id="calc-title" class="text-xl font-bold text-white mb-4 border-b border-slate-600 pb-2"></h5>
                        <div class="mb-4">
                            <p id="calc-formula" class="text-slate-400 font-mono text-sm mb-1">C√¥ng th·ª©c: ...</p>
                            <p id="calc-substitution" class="text-yellow-400 font-mono text-lg mb-4">Thay s·ªë: ...</p>
                            <label class="block text-sm text-slate-300 mb-1">Nh·∫≠p k·∫øt qu·∫£ c·ªßa em:</label>
                            <input type="number" id="student-answer" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-3 text-white text-xl font-bold focus:outline-none focus:border-green-500 transition placeholder-slate-600" placeholder="VD: 10">
                        </div>
                        <button onclick="checkCalculation()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition">KI·ªÇM TRA</button>
                        <p id="calc-feedback" class="mt-4 text-center font-bold text-lg"></p>
                    </div>
                    <div id="calc-placeholder" class="text-center text-slate-500">
                        <i class="fas fa-arrow-left text-2xl mb-2"></i>
                        <p>Ch·ªçn b√†i t·∫≠p b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu t√≠nh to√°n</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <div class="text-center text-gray-400 text-sm hand-font pb-8">
            <p>H·ªçc to√°n th·∫≠t vui c√πng Canvas! ‚ú®</p>
            <p class="mt-2 text-xl text-blue-600 font-bold animate-bounce">Ch√∫c m·ª´ng b·∫°n ƒë√£ v∆∞·ª£t qua ph·∫ßn nh·∫≠p m√¥n bi·ªÉu th·ª©c ƒë·∫°i s·ªë! üéì</p>
        </div>

    </div>

    <script>
        // --- LOGIC M·ªû KH√ìA SECTION ---
        function unlockSection(id) {
            const section = document.getElementById(id);
            section.classList.remove('hidden-section');
            section.classList.add('active-section');
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // --- LOGIC TH·ª∞C H√ÄNH 1 ---
        let currentSelection = null;
        function moveItem(el) {
            const parent = el.parentElement.id;
            if (parent === 'drag-container') {
                if (currentSelection) currentSelection.classList.remove('ring-4', 'ring-blue-400');
                currentSelection = el;
                el.classList.add('ring-4', 'ring-blue-400');
            } else {
                document.getElementById('drag-container').appendChild(el);
                el.classList.remove('ring-4', 'ring-blue-400');
                currentSelection = null;
            }
        }
        ['zone-so', 'zone-dai-so'].forEach(id => {
            document.getElementById(id).onclick = function() {
                if(currentSelection) {
                    this.querySelector('.content').appendChild(currentSelection);
                    currentSelection.classList.remove('ring-4', 'ring-blue-400');
                    currentSelection = null;
                }
            }
        });
        function checkPractice1() {
            const zoneSo = document.getElementById('zone-so').querySelectorAll('.expression-tag');
            const zoneDaiSo = document.getElementById('zone-dai-so').querySelectorAll('.expression-tag');
            let correct = 0, total = 5;
            zoneSo.forEach(el => { if(el.dataset.type === 'so') { el.classList.add('bg-green-100', 'border-green-500'); correct++; } else el.classList.add('bg-red-100', 'border-red-500'); });
            zoneDaiSo.forEach(el => { if(el.dataset.type === 'dai-so') { el.classList.add('bg-green-100', 'border-green-500'); correct++; } else el.classList.add('bg-red-100', 'border-red-500'); });
            const resultText = document.getElementById('p1-result');
            if (correct === total) {
                resultText.innerText = "Ch√≠nh x√°c! S·ªï tay ki·∫øn th·ª©c ƒë√£ m·ªü! üéâ";
                resultText.className = "mt-2 font-bold text-lg text-green-600";
                unlockSection('section-notebook-1');
            } else {
                resultText.innerText = `B·∫°n l√†m ƒë√∫ng ${correct}/${total}. H√£y th·ª≠ l·∫°i nh√©!`;
                resultText.className = "mt-2 font-bold text-lg text-orange-600";
            }
        }

        // --- LOGIC H∆Ø·ªöNG D·∫™N THAY S·ªê (DEMO) ---
        function runDemoStep1() {
            const displayVar = document.getElementById('demo-var');
            const controls = document.getElementById('demo-controls');
            const explain = document.getElementById('demo-explanation');
            
            // Animation
            displayVar.classList.add('bg-white', 'text-slate-900', 'px-2', 'rounded');
            
            setTimeout(() => {
                displayVar.innerText = "(3)"; // Thay x b·∫±ng 3
                explain.innerText = "B∆∞·ªõc 1: Ta thay ch·ªØ x b·∫±ng s·ªë 3";
                
                // ƒê·ªïi n√∫t sang b∆∞·ªõc 2
                controls.innerHTML = `
                    <button onclick="runDemoStep2()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-6 py-3 rounded-full shadow-lg transition transform active:scale-95 text-lg">
                        B∆∞·ªõc 2: T√≠nh to√°n
                    </button>
                `;
            }, 500);
        }

        function runDemoStep2() {
            const display = document.getElementById('demo-display');
            const controls = document.getElementById('demo-controls');
            const explain = document.getElementById('demo-explanation');
            
            display.innerHTML = "6 + 1";
            explain.innerText = "B∆∞·ªõc 2: Th·ª±c hi·ªán ph√©p nh√¢n 2 . 3 = 6";
            
            setTimeout(() => {
                display.innerHTML = "<span class='text-green-400 font-bold scale-125 inline-block'>7</span>";
                explain.innerText = "Cu·ªëi c√πng: 6 + 1 = 7. V·∫≠y gi√° tr·ªã l√† 7.";
                controls.innerHTML = ""; // X√≥a n√∫t
                document.getElementById('btn-finish-demo').classList.remove('hidden');
            }, 1500);
        }

        // --- LOGIC TR·∫ÆC NGHI·ªÜM ---
        function checkOption(el, isCorrect, group) {
            const options = document.querySelectorAll(`.quiz-option.${group}`);
            options.forEach(opt => opt.classList.remove('bg-green-100', 'border-green-500', 'bg-red-100', 'border-red-500', 'text-green-700', 'text-red-700'));
            if (isCorrect) el.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
            else el.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
        }

        // --- LOGIC T·ª∞ T√çNH ---
        let activeCalc = null;
        function setupCalculation(type) {
            document.getElementById('calc-placeholder').classList.add('hidden');
            document.getElementById('calc-interface').classList.remove('hidden');
            const title = document.getElementById('calc-title');
            const formula = document.getElementById('calc-formula');
            const sub = document.getElementById('calc-substitution');
            const input = document.getElementById('student-answer');
            const feedback = document.getElementById('calc-feedback');
            
            input.value = '';
            feedback.innerText = '';
            activeCalc = type;

            if (type === 'th3') {
                title.innerText = "Th·ª±c H√†nh 3: T√≠nh gi√° tr·ªã P";
                formula.innerText = "Bi·ªÉu th·ª©c: P = 3x¬≤ - 4x";
                sub.innerHTML = "Thay x = 2: P = 3.(2)¬≤ - 4.(2) = ?";
                sub.className = "text-yellow-400 font-mono text-lg mb-4 block"; 
            } else if (type === 'vd2') {
                title.innerText = "V·∫≠n D·ª•ng 2: T√≠nh gi√° gi√†y";
                formula.innerText = "Bi·ªÉu th·ª©c: T = C + C.r";
                sub.innerHTML = "Thay C=600, r=10% (0.1):<br>T = 600 + 600 . 0.1 = ?";
                sub.className = "text-yellow-400 font-mono text-lg mb-4 block"; 
            } else if (type === 'negative') {
                title.innerText = "Th·ª≠ Th√°ch: S·ªë √Çm";
                formula.innerText = "Bi·ªÉu th·ª©c: A = 2x¬≤ - 5x";
                sub.innerHTML = "(H√£y t·ª± thay x = -4 v√†o nh√°p v√† t√≠nh nh√©!)";
                sub.className = "text-slate-500 italic text-sm mb-4 block"; 
            }
        }

        function checkCalculation() {
            const val = parseFloat(document.getElementById('student-answer').value);
            const feedback = document.getElementById('calc-feedback');
            if (isNaN(val)) {
                feedback.innerText = "Vui l√≤ng nh·∫≠p s·ªë!";
                feedback.className = "mt-4 text-center font-bold text-lg text-yellow-500";
                return;
            }
            let correctVal = 0;
            if (activeCalc === 'th3') correctVal = 4; 
            else if (activeCalc === 'vd2') correctVal = 660; 
            else if (activeCalc === 'negative') correctVal = 52; 

            if (val === correctVal) {
                feedback.innerHTML = "Ch√≠nh x√°c! Gi·ªèi qu√°! üåü";
                feedback.className = "mt-4 text-center font-bold text-lg text-green-400";
            } else {
                feedback.innerHTML = `Ch∆∞a ƒë√∫ng. H√£y t√≠nh l·∫°i nh√©!`;
                feedback.className = "mt-4 text-center font-bold text-lg text-red-400";
            }
        }
    </script>

</body>
</html>